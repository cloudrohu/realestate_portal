{% load static %}

{% load static %}

<!-- ====================== -->
<!-- DESKTOP SEARCH SECTION -->
<!-- ====================== -->
<div class="hidden md:block">
  <section 
    class="relative flex flex-col items-center justify-center text-center text-white h-[500px] bg-cover bg-center bg-no-repeat overflow-hidden"
    style="background-image: url('{% if settings_obj.search_bg %}{{ settings_obj.search_bg.url }}{% else %}{% static 'images/central-mumbai.jpeg' %}{% endif %}');">

    <h1 class="text-3xl md:text-4xl font-bold mb-2">India's Largest Real Estate Platform</h1>
    <p class="text-gray-300 mb-6">
      We’ve got you covered! From finding the perfect property to
      <span class="text-pink-400">Transactions</span>
    </p>

    <!-- Search Box -->
    <div class="bg-white/30 w-[90%] md:w-[55%] rounded-2xl p-3 shadow-xl text-gray-700 backdrop-blur-sm relative">

      <!-- Tabs -->
      <div id="tabMenu" class="flex flex-wrap items-center gap-2 pb-2 mb-1 border-b border-gray-200">
        <button class="tab-btn px-4 py-2 rounded-md font-semibold text-blue-700 bg-gray-200" data-tab="buy">Buy</button>
        <button class="tab-btn px-4 py-2 rounded-md hover:bg-gray-100" data-tab="new">New Projects</button>
        <button class="tab-btn px-4 py-2 rounded-md hover:bg-gray-100" data-tab="rental">Rental</button>
      </div>

      <!-- Filters -->
      <div class="relative bg-white/30 flex flex-wrap items-center gap-2 rounded-md">
        <select id="propertyType" class="border rounded-md px-3 py-2 w-40">
          <option>Residential</option>
          <option>Commercial</option>
        </select>

        <div class="relative flex-grow">
          <input id="searchInput" type="text" placeholder="Select City"
            class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/90" autocomplete="off" />

          <!-- Suggestion Box -->
          <ul id="suggestionBox" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto hidden z-50"></ul>
        </div>

        <button id="searchButton" class="bg-green-500 text-white px-6 py-2 rounded-md font-semibold hover:bg-green-600 transition">
          Search
        </button>
      </div>
    </div>
  </section>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const tabs = document.querySelectorAll(".tab-btn");
  const select = document.getElementById("propertyType");
  const searchInput = document.getElementById("searchInput");
  const suggestionBox = document.getElementById("suggestionBox"); // ✅ use existing ul, don't recreate it

  const tabOptions = {
    buy: ["Residential", "Commercial"],
    rental: ["Residential", "Commercial Lease", "PG / Co-living"],
    new: ["Residential", "Commercial"]
  };

  // ✅ Tab click logic
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("bg-gray-200", "text-blue-700", "font-semibold"));
      tab.classList.add("bg-gray-200", "text-blue-700", "font-semibold");

      const selectedTab = tab.dataset.tab;
      select.innerHTML = "";
      tabOptions[selectedTab].forEach(opt => {
        const option = document.createElement("option");
        option.textContent = opt;
        select.appendChild(option);
      });

      searchInput.placeholder = "Select City";
    });
  });

  // ✅ Auto-suggestion from database (AJAX)
  searchInput.addEventListener("input", async () => {
    const query = searchInput.value.trim();
    suggestionBox.innerHTML = "";

    if (query.length < 3) {
      suggestionBox.classList.add("hidden");
      return;
    }

    try {
      const response = await fetch(`/api/cities/?q=${encodeURIComponent(query)}`);
      if (!response.ok) throw new Error("Network error");

      const results = await response.json();

      if (results.length === 0) {
        suggestionBox.innerHTML = `<li class="px-4 py-2 text-sm text-gray-500">No results found</li>`;
        suggestionBox.classList.remove("hidden");
        return;
      }

      // ✅ Add results dynamically
      results.forEach(item => {
        const li = document.createElement("li");
        li.className = "px-4 py-2 hover:bg-gray-100 flex justify-between items-center cursor-pointer text-sm";
        li.innerHTML = `
          <span>${item.name}</span>
          <span class="text-gray-500 text-xs">${item.type}</span>
        `;
        li.addEventListener("click", () => {
          searchInput.value = item.name;
          suggestionBox.classList.add("hidden");
        });
        suggestionBox.appendChild(li);
      });

      suggestionBox.classList.remove("hidden");
    } catch (error) {
      console.error("❌ Error fetching cities:", error);
      suggestionBox.innerHTML = `<li class="px-4 py-2 text-sm text-red-500">Error fetching data</li>`;
      suggestionBox.classList.remove("hidden");
    }
  });

  // ✅ Hide dropdown on outside click
  document.addEventListener("click", (e) => {
    if (!e.target.closest("#searchInput")) {
      suggestionBox.classList.add("hidden");
    }
  });
});
</script>
<!-- ====================== -->
<!-- MOBILE SEARCH SECTION -->
<!-- ====================== -->
<div class="md:hidden">
  <section 
    class="relative flex flex-col items-center justify-center text-center text-white h-[450px] bg-cover bg-center bg-no-repeat overflow-hidden"
    style="background-image: url('{% if settings_obj.search_bg %}{{ settings_obj.search_bg.url }}{% else %}{% static 'images/central-mumbai.jpeg' %}{% endif %}');">

    <!-- Overlay -->
    <div class="absolute inset-0 bg-black/60"></div>

    <!-- CONTENT -->
    <div class="relative z-10 w-full px-4 sm:px-6 md:px-10">
      <h2 class="text-2xl md:text-3xl font-bold mb-2 drop-shadow-lg">Real Estate Made Real Easy</h2>
      <p class="text-gray-300 mb-6 text-sm md:text-base">
        We’ve got you covered! From finding the perfect property to
        <span class="text-pink-400 font-semibold">Interiors</span>
      </p>

      <!-- Tabs -->
      <div id="mobileTabs" class="flex justify-center gap-2 mt-2 whitespace-nowrap overflow-x-auto scrollbar-hide">
        <button class="tab-btn bg-white text-black px-3 py-2 rounded-md font-semibold" data-tab="buy">Buy</button>
        <button class="tab-btn bg-[#122c61] text-white px-3 py-2 rounded-md hover:bg-[#163070]" data-tab="projects">New Projects</button>
        <button class="tab-btn bg-[#122c61] text-white px-3 py-2 rounded-md hover:bg-[#163070]" data-tab="rental">Rental</button>
      </div>

      <!-- ✅ Search Bar -->
      <div class="flex items-center bg-white/60 mx-auto mt-6 rounded-full px-4 py-2 text-gray-700 shadow-lg max-w-lg relative" id="searchBar">
        <select id="propertyTypeSelect" class="text-sm font-sm text-gray-600 bg-transparent border-none outline-none cursor-pointer focus:ring-0 pr-0 ml-0">
          <option value="residential">Residential</option>
          <option value="commercial">Commercial</option>
        </select>

        <div class="h-5 w-px bg-gray-300 mx-2"></div>

        
        <!-- ✅ Input + Suggestion Dropdown -->
        <div class="relative flex-grow">
          <input id="mobileSearchInput" type="text" placeholder="Select City"
            class="w-full outline-none text-sm bg-transparent placeholder-gray-500" autocomplete="off" />
          <ul id="mobileSuggestionBox" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto hidden z-50"></ul>
        </div>

        <button id="mobileSearchButton" 
          class=" text-white px-1 py-1 rounded-full ml-2 hover:bg-[#163070] transition flex items-center justify-center">
          <!-- Search Icon Only -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M21 21l-4.35-4.35M11 6a5 5 0 100 10 5 5 0 000-10z" />
          </svg>
        </button>


      </div>
    </div>
  </section>

  <style>
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</div>

<!-- ====================== -->
<!-- ✅ MOBILE JS LOGIC -->
<!-- ====================== -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const tabs = document.querySelectorAll("#mobileTabs .tab-btn");
  const select = document.getElementById("propertyTypeSelect");
  const input = document.getElementById("mobileSearchInput");
  const suggestionBox = document.getElementById("mobileSuggestionBox");

  const tabOptions = {
    buy: ["Residential", "Commercial"],
    rental: ["Residential", "Commercial Lease", "PG / Co-living"],
    projects: ["Residential", "Commercial"]
  };

  // ✅ Tab switching logic
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => {
        t.classList.remove("bg-white", "text-black", "font-semibold");
        t.classList.add("bg-[#122c61]", "text-white");
      });

      tab.classList.add("bg-white", "text-black", "font-semibold");
      tab.classList.remove("bg-[#122c61]", "text-white");

      const selectedTab = tab.dataset.tab;
      select.innerHTML = "";
      tabOptions[selectedTab].forEach(opt => {
        const option = document.createElement("option");
        option.value = opt.toLowerCase().replace(/\s+/g, "-");
        option.textContent = opt;
        select.appendChild(option);
      });

      input.placeholder = "Select City";
    });
  });

  // ✅ Fetch suggestions from Django API
  input.addEventListener("input", async () => {
    const query = input.value.trim();
    suggestionBox.innerHTML = "";

    if (query.length < 3) {
      suggestionBox.classList.add("hidden");
      return;
    }

    try {
      const response = await fetch(`/api/cities/?q=${encodeURIComponent(query)}`);
      if (!response.ok) throw new Error("Network error");

      const results = await response.json();

      if (results.length === 0) {
        suggestionBox.innerHTML = `<li class="px-4 py-2 text-sm text-gray-500">No results found</li>`;
        suggestionBox.classList.remove("hidden");
        return;
      }

      results.forEach(item => {
        const li = document.createElement("li");
        li.className = "px-4 py-2 hover:bg-gray-100 flex justify-between items-center cursor-pointer text-sm";
        li.innerHTML = `
          <span>${item.name}</span>
          <span class="text-gray-500 text-xs">${item.type}</span>
        `;
        li.addEventListener("click", () => {
          input.value = item.name;
          suggestionBox.classList.add("hidden");
        });
        suggestionBox.appendChild(li);
      });

      suggestionBox.classList.remove("hidden");
    } catch (error) {
      console.error("Error fetching cities:", error);
      suggestionBox.innerHTML = `<li class="px-4 py-2 text-sm text-red-500">Error fetching data</li>`;
      suggestionBox.classList.remove("hidden");
    }
  });

  // ✅ Hide dropdown on outside click
  document.addEventListener("click", (e) => {
    if (!e.target.closest("#mobileSearchInput")) {
      suggestionBox.classList.add("hidden");
    }
  });
});
</script>
